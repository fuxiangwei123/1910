"use strict";var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ajaxGet(e,t,n){n=n||{};var i="";for(var s in n)i+=s+"="+n[s]+"&";e=e+"?"+i+"__qft="+(new Date).getTime();var a=new XMLHttpRequest;a.open("get",e,!0),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&t(a.responseText)},a.send()}function ajaxPost(e,t,n){n=n||{};var i="";for(var s in n)i+=s+"="+n[s]+"&";var a=new XMLHttpRequest;a.open("POST",e,!0),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&t(a.responseText)},a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(i)}function jsonp(e,t,n){var i="";for(var s in n)i+=s+"="+n[s]+"&";e=e+"?"+i.slice(0,i.length-1);var a=document.createElement("script");a.src=e,document.body.appendChild(a),window[n[n.columnName]]=function(e){t(e)}}function setCookie(e,t,n){var i=(n=n||{}).path?";path="+n.path:"";if(n.expires){var s=new Date;s.setDate(s.getDate()+n.expires);var a=";expires="+s}else a="";document.cookie=e+"="+t+i+a}function removeCookie(e,t){(t=t||{}).expires=-1,setCookie(e,null,t)}function _getCookie(e){for(var t=document.cookie.split("; "),n=0;n<t.length;n++)if(t[n].split("=")[0]===e)return t[n].split("=")[1];return""}var Con=function(){function t(e){_classCallCheck(this,t),this.url=e.url,this.intro=e.intro,this.load()}return _createClass(t,[{key:"load",value:function(){var t=this;ajaxGet(this.url,function(e){t.res=JSON.parse(e),t.getCookie()})}},{key:"getCookie",value:function(){this.goodss=_getCookie("goodss")?JSON.parse(_getCookie("goodss")):[],this.display()}},{key:"display",value:function(){for(var e="",t=0;t<this.res.length;t++)this.res[t].goodsId===this.goodss[0].index&&(e='<div class="fl fangda">\n                <div class="photo">\n                    <div class="photo-l" id="wrap">\n                        <img class="ts" src="'+this.res[t].img+'" >\n                        <div class="kong" id="box"></div>\n                    </div>\n                    <div class="photo-r" id="bigerea" style="background-image: url('+this.res[t].img+');">\n                    </div>\n                </div>\n                <div class="send">\n                    <img src="images/ts1.jpg">\n                    <img src="images/gb.jpg">\n                    <img src="images/count_02.jpg">\n                    <img src="images/ts3.jpg">\n                    <img src="images/count_04.jpg">\n                    <img src="images/gb.jpg">\n                </div>\n            </div>\n            <div class="detail fl" index="'+this.res[t].goodsId+'">\n                <div class="name d1">'+this.res[t].name+'</div>\n                <div class="vipprice d1">现价：<span>'+this.res[t].vipprice+'</span>元</div>\n                <div class="price d1">定价：￥<span>'+this.res[t].price+'</span></div>\n                <div class="zhe d1"><span>折扣：<b>'+(this.res[t].vipprice/this.res[t].price).toFixed(2)+"</b>折</span><em>节省：￥<b>"+(this.res[t].price-this.res[t].vipprice).toFixed(2)+'</b>元</em></div>\n                <div class="stock d1">库存：'+this.res[t].stock+'</div>\n                <div class="line" id="line"></div>\n                <div class="writer">\n                    <div class="wname d1"><span>作者：杨帆</span><em>出生日期：2012/2/2</em></div>\n                    <div class="chu d1"><span>出版社：三位数</span><em>页数：</em></div>\n                    <div class="isbn d1"><span>ISBN：212345432</span><em>装帧：</em></div>\n                    <div class="kai d1"><span>开本：16开</span><em>字数：</em></div>\n                </div>\n                <div class="mai">\n                    <div class="mai-t">\n                        我要买：\n                        <input type="image" src="images/count_04.jpg" class="tu up" name="up" >\n                        <input type="text" value="'+this.goodss[0].sum+'" class="txt">\n                        <input type="image" src="images/count_02.jpg" class="tu down" name="down">    \n                        件\n                    </div>\n                    <div class="mai-b clear">\n                        <a href="shopcar.html" class="m1">立即购买</a>\n                        <a href="#" class="m2">&nbsp;&nbsp;&nbsp;&nbsp;加入收藏夹</a>\n                    </div>\n                </div>\n            </div>\n                ');this.intro.innerHTML=e,this.fa(),this.addEvent()}},{key:"fa",value:function(){var c=document.getElementById("wrap"),d=document.querySelector("#box"),l=document.getElementById("bigerea");function p(e){var t={left:0,top:0};t.left=e.offsetLeft,t.top=e.offsetTop;for(var n=-1!=window.navigator.userAgent.indexOf("MSIE 8"),i=e.offsetParent;i!=document.body;)n?(t.left+=i.offsetLeft,t.top+=i.offsetTop):(t.left+=i.offsetLeft+i.clientLeft,t.top+=i.offsetTop+i.clientTop),i=i.offsetParent;return t}c.onmouseenter=function(){d.style.display="block",l.style.display="block";var r=(c.clientWidth-d.clientWidth)/(450-l.clientWidth);document.onmousemove=function(e){var t=e.pageX,n=e.pageY,i=p(c).left,s=p(c).top,a=t-i-c.clientLeft-d.clientWidth/2,o=n-s-c.clientTop-d.clientHeight/2;a<0?a=0:a>c.clientWidth-d.clientWidth&&(a=c.clientWidth-d.clientWidth),o<0?o=0:o>c.clientHeight-d.clientHeight&&(o=c.clientHeight-d.clientHeight),d.style.left=a+"px",d.style.top=o+"px",l.style.backgroundPositionX=-a/r+"px",l.style.backgroundPositionY=-o/r+"px"}},c.onmouseleave=function(){d.style.display="none",l.style.display="none"}}},{key:"addEvent",value:function(){var t=this;this.intro.addEventListener("click",function(e){"tu up"==e.target.className&&(t.index=e.target.parentNode.parentNode.parentNode.getAttribute("index"),t.v=+e.target.nextElementSibling.value+1,t.value=t.v,t.goodss[0].sum=t.value,t.display()),"tu down"==e.target.className&&(t.index=e.target.parentNode.parentNode.parentNode.getAttribute("index"),t.v2=e.target.previousElementSibling.value-1,t.v2<0?t.v2=0:t.value=t.v2,t.goodss[0].sum=t.value,t.display())})}}]),t}();new Con({url:"http://localhost/xinhua/shop.json",intro:document.querySelector(".intro-t")});