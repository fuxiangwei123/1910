"use strict";var _createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ajaxGet(t,e,n){n=n||{};var i="";for(var o in n)i+=o+"="+n[o]+"&";t=t+"?"+i+"__qft="+(new Date).getTime();var s=new XMLHttpRequest;s.open("get",t,!0),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&e(s.responseText)},s.send()}function ajaxPost(t,e,n){n=n||{};var i="";for(var o in n)i+=o+"="+n[o]+"&";var s=new XMLHttpRequest;s.open("POST",t,!0),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&e(s.responseText)},s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(i)}function jsonp(t,e,n){var i="";for(var o in n)i+=o+"="+n[o]+"&";t=t+"?"+i.slice(0,i.length-1);var s=document.createElement("script");s.src=t,document.body.appendChild(s),window[n[n.columnName]]=function(t){e(t)}}function setCookie(t,e,n){var i=(n=n||{}).path?";path="+n.path:"";if(n.expires){var o=new Date;o.setDate(o.getDate()+n.expires);var s=";expires="+o}else s="";document.cookie=t+"="+e+i+s}function removeCookie(t,e){(e=e||{}).expires=-1,setCookie(t,null,e)}function _getCookie(t){for(var e=document.cookie.split("; "),n=0;n<e.length;n++)if(e[n].split("=")[0]===t)return e[n].split("=")[1];return""}var Car=function(){function e(t){_classCallCheck(this,e),this.url=t.url,this.tbody=t.tbody,this.count1=0,this.count2=0,this.count3=0,this.load(),this.addEvent(),this.all=t.all}return _createClass(e,[{key:"load",value:function(){var e=this;ajaxGet(this.url,function(t){e.res=JSON.parse(t),e.getCookie()})}},{key:"getCookie",value:function(){this.goods=_getCookie("goods")?JSON.parse(_getCookie("goods")):[],this.display()}},{key:"display",value:function(){for(var t="",e=0;e<this.res.length;e++)for(var n=0;n<this.goods.length;n++)this.res[e].goodsId===this.goods[n].id&&(this.em=this.goods[n].num,this.b=(this.res[e].price-this.res[e].vipprice)*this.em,this.span=this.res[e].vipprice*this.em,t+='<tr index="'+this.goods[n].id+'">\n                        <td><a href="content">'+this.res[e].name+"</a></td>\n                        <td>"+this.goods[n].id+"</td>\n                        <td>"+this.res[e].price+"</td>\n                        <td>"+this.res[e].vipprice+'</td>\n                        <td align="center">\n                            <input type="image" src="images/count_04.jpg" class="tu up" name="up" >\n                            <input type="text" value="'+this.goods[n].num+'" style="width: 37px;" class="txt">\n                            <input type="image" src="images/count_02.jpg" class="tu down" name="down">\n                        </td>\n                        <td><span>删除</span></td>\n                        <td>'+this.res[e].stock+"</td>\n                    </tr>\n                    ",this.count1+=this.em-0,this.count2+=this.b-0,this.count3+=this.span-0);this.all.innerHTML="合计&nbsp;&nbsp;&nbsp;\n        册数：<em>"+this.count1+"</em>&nbsp;&nbsp;&nbsp; \n        您共节省：¥<b>"+this.count2.toFixed(2)+'</b>元&nbsp;&nbsp;&nbsp;\n            金额：<span class="money2">¥'+this.count3.toFixed(2)+"</span>元",this.tbody.innerHTML=t}},{key:"addEvent",value:function(){var e=this;this.tbody.addEventListener("click",function(t){"SPAN"==t.target.tagName&&(e.id=t.target.parentNode.parentNode.getAttribute("index"),t.target.parentNode.parentNode.remove(),e.updateCookie(function(t){e.goods.splice(t,1),e.count1=0,e.count2=0,e.count3=0,e.display()}))}),this.tbody.addEventListener("click",function(t){"tu up"==t.target.className&&(e.id=t.target.parentNode.parentNode.getAttribute("index"),t.target.nextElementSibling.value=+t.target.nextElementSibling.value+1,e.value=t.target.nextElementSibling.value,e.updateCookie(function(t){e.goods[t].num=e.value,e.count1=0,e.count2=0,e.count3=0,e.display()}))}),this.tbody.addEventListener("click",function(t){"tu down"==t.target.className&&(e.id=t.target.parentNode.parentNode.getAttribute("index"),t.target.previousElementSibling.value=t.target.previousElementSibling.value-1,console.log(t.target.previousElementSibling.value),t.target.previousElementSibling.value<0?t.target.previousElementSibling.value:e.value=t.target.previousElementSibling.value,e.updateCookie(function(t){e.goods[t].num=e.value,e.count1=0,e.count2=0,e.count3=0,e.display()}))})}},{key:"updateCookie",value:function(t){for(var e=0;e<this.goods.length;e++)this.goods[e].id===this.id&&t(e);setCookie("goods",JSON.stringify(this.goods))}}]),e}();new Car({url:"http://localhost/xinhua/shop.json",tbody:document.querySelector("tbody"),all:document.querySelector(".main-b2")});